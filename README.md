# Учебное задание «Разработка распределенного приложения для локальной сети»

**1. Общее описание приложения и предметной области**

Предметная область – бронирование комнат в хостелах или в других местах. Клиент может просмотреть список всех комнат и их статус, а также забронировать комнату на своё имя.

**2. Архитектура системы**

Система состоит из клиентов, одного диспетчера, серверов бронирования, серверов управления местами и БД под управлением PostgreSQL, расположенной на виртуальной машине на платформе Yandex Cloud.
![image](https://github.com/CVH4OYC/Room_reservation/assets/166644659/ff4e7c64-5fa4-4b05-8f40-721533f9cf76)

**3. Алгоритм работы приложения**

1.	Все узлы запускаются и настраиваются с помощью соответствующих конфигурационных файлов, где указаны адреса подключения каждого из узлов, взаимодействие между ними происходит при помощи gRPC.
2.	Клиент может отправить один из двух запросов диспетчеру: просмотр списка комнат и их статус, бронирование определенной комнаты на имя клиента.
3.	Если клиент отправляет запрос на просмотр комнат диспетчеру, то диспетчер пересылает этот запрос одному из серверов управления местами, который уже просмотрит БД и вернёт результат в виде списка мест обратно диспетчеру, а тот клиенту.
4.	Если клиент отправляет запрос на бронирование комнаты, где указывает номер комнаты и своё имя, диспетчеру, то диспетчер пересылает этот запрос одному из серверов бронирования, который пересылает запрос одному из серверов управления местами. Сервер управления местами просматривает БД и определяет, свободна ли выбранная комната. Если свободна, то комната бронируется, и клиенту через сервер бронирования и диспетчер отправляется ответ об успешном бронировании. Если комната была занята, то таким же образом отправляется ответ о невозможности бронирования данной комнаты.
5.	Если в конфигурационных файлах описано более одного сервера любого вида, то распределение запросов между ними определяется круговым порядком.
6.	Если какой-то узел становится недоступен, то клиенту будет сообщено о недоступности узла.
7.	Доступность диспетчера для клиента производится в отдельном потоке раз в секунду. Доступность серверов для диспетчера, серверов управления местами для серверов бронирования также происходит в отдельных потоках.

**4. Отказоустойчивость системы**

При выходе из строя одного из элементов системы, клиенту будут выводиться соответствующие сообщения о недоступности одного из узлов. При восстановлении вышедшего из строя узла остальные элементы системы не нужно будет перезагружать, и система продолжит работу. 
Если из строя выйдет диспетчер, то клиенту будет выведено соответствующее сообщение. Когда диспетчер вновь восстановится, то клиент через несколько секунд обнаружит его и сможет снова посылать ему запросы.

**5.	Работа с БД**

Комнаты, их статус, и имена забронировавшего хранятся в БД, расположенной на виртуальной машине в Yandex Cloud. Сама БД представлена одной таблицей rooms со следующими полями:
roomid 	roomname 	roomstatus	guestname
В БД добавлены несколько комнат со статусом «Свободно», а поле guestname содержит NULL.

**6. Пояснения по содержимому**
В папках с конфигурационными файлами содержатся txt файлы, которы вставляются в папку "Сервер/Управление местами" с самим приложением. Также в этой папке содержится proto файл reservation.proto, в котором описана структура передаваемых данных. Для создания дополнительных серверов бронирования и управления местами нужно скопировать один из существующих серверов, создать и заполнить для него конфигурационный файл, а в самом коде указать путь к конфигурационному файлу.
